<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Capital Document Number Request Form</title>
		<link rel="stylesheet" type="text/css" href="style.css" />
		<meta
			name="description"
			content="A form that allows TfL workers to request document identification numbers for sharing."
		/>
	</head>
	<body>
		<nav></nav>
		<main>
			<form>
				<label>
					Project
					<select name="project" required>
						<option value="">Unknown</option>
					</select>
				</label>
				<label>
					Document Revision
					<input type="text" name="document_revision" />
				</label>
				<label>
					Document Title
					<input type="text" name="document_title" />
				</label>
				<label>
					Purpose of Issue
					<input type="text" name="document_issue_reason" />
				</label>
				<label>
					Asset Class
					<input type="text" name="asset_class" />
				</label>
				<label>
					Information Type
					<input type="text" name="information_type" />
				</label>
				<label>
					Discipline
					<input type="text" name="discipline" />
				</label>
				<label>
					Suitability
					<input type="text" name="suitability" />
				</label>
				<label>
					TfL Security Classification
					<input type="text" name="security_classification" />
				</label>
				<label>
					Project Stage
					<input type="text" name="project_stage" />
				</label>
				<label>
					Handover Information
					<input type="text" name="handover_information" />
				</label>
				<label>
					Health &amp; Safety File
					<input type="text" name="health_and_safety_file" />
				</label>
				<label>
					Requested by
					<input type="text" name="requested_by" />
				</label>
				<label>
					Project Email Address
					<input type="email" name="project_email" required />
				</label>

				<button type="submit">Send</button>
			</form>
		</main>
		<footer></footer>

		<script lang="javascript">
			const projectsDropdown = document.getElementsByName('project')[0];
			const projectEmailElement = document.getElementsByName('project_email')[0];

			// addEventListener - a function that runs when the project name dropdown changes.
			// inside the event listener - just fill the email field with something random.
			projectsDropdown.addEventListener('change', (e) => {
				e.preventDefault()
				const value = e.target.value;
				const selectedProject = window.__projects.find((p => p.number === value));
				if (selectedProject){
					projectEmailElement.value = selectedProject.email;
				}
			});

			async function populateProjects(select){
				const response = await fetch('/fixtures/projects.json');
				const { projects } = await response.json();

				window.__projects = projects;

				for (const project of projects) {
					console.log(project);
					const option = document.createElement('option');
					option.value = project.name;
					option.innerText = `${project.name} (${project.number})`;
				select.appendChild(option);
				}
			}
			
			populateProjects(projectsDropdown)
			// Date.now();
			// Store the list of projects somewhere globally accessable
			// window.__projects = projects - inside the last then on the fetch
			// inside the event listener filter the list of projects based on the selection
			//    window.__projects.find(p => p.name === dropdown.value)
			// set the value of the email input to the value of project.email
		</script>
	</body>
</html>
